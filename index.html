<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>President v1.6.55</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden;font-family:Arial,sans-serif;background:#0a1f0f;color:#fff}
.game{display:flex;flex-direction:column;height:100vh;padding:4px;padding-bottom:20px}
.top-bar{background:linear-gradient(135deg,#1a8c3a,#0d5f1f);padding:6px;border-radius:8px;margin-bottom:4px;flex-shrink:0}
.current-turn{font-size:.95em;font-weight:bold;color:#ffeb3b;text-align:center;margin-bottom:2px}
.role-display{font-size:.8em;color:#51cf66;text-align:center;background:rgba(81,207,102,.1);padding:4px;border-radius:4px;margin-bottom:2px;font-weight:bold}
.players-row{display:flex;gap:4px;overflow-x:auto;max-height:65px}
.player-card{flex-shrink:0;background:rgba(255,255,255,.1);padding:4px 7px;border-radius:6px;min-width:65px;border-left:3px solid #666;font-size:.7em}
.player-card.active{border-left-color:#ffeb3b;background:rgba(255,235,59,.2)}
.player-card.you{border-left-color:#51cf66}
.player-name{font-weight:bold}
.player-info{color:#ccc;font-size:.65em;margin-top:1px}
.table-section{background:linear-gradient(135deg,#0d5f1f,#1a8c3a);padding:10px;border-radius:8px;margin-bottom:4px;text-align:center;flex-shrink:0;min-height:110px;display:flex;flex-direction:column;justify-content:center}
.pile-title{font-size:.65em;color:#aaa;margin-bottom:6px}
.pile-display{display:flex;gap:4px;justify-content:center;align-items:center;flex-wrap:wrap;min-height:65px}
.pile-card{width:40px;height:60px;background:#fff;border:2px solid #333;border-radius:4px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:10px;flex-shrink:0}
.pile-card.red{color:#d32f2f}
.pile-card.black{color:#1a1a1a}
.hand-area{background:rgba(255,255,255,.05);border-radius:8px;padding:6px;margin-bottom:4px;border:1px solid #333;max-height:160px;overflow-y:auto;flex-shrink:0}
.hand-title{font-size:.7em;font-weight:bold;margin-bottom:4px;color:#aaa}
.hand-display{display:flex;flex-wrap:wrap;gap:3px;justify-content:center}
.card{width:38px;height:56px;background:linear-gradient(135deg,#fff,#f0f0f0);border:2px solid #333;border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:2px;cursor:pointer;transition:all .2s;flex-shrink:0}
.card.red{color:#d32f2f}
.card.black{color:#1a1a1a}
.card.selected{background:linear-gradient(135deg,#1a8c3a,#0d5f1f);color:#fff;border-color:#51cf66;transform:translateY(-5px);box-shadow:0 2px 8px rgba(81,207,102,.5)}
.card-rank{font-size:10px;font-weight:bold}
.card-suit{font-size:11px}
.log-section{background:#1a1a1a;padding:6px;border-radius:8px;height:70px;overflow-y:auto;font-family:monospace;font-size:.6em;line-height:1.2;border:1px solid #333;margin-bottom:4px;color:#0f0;flex-shrink:0}
.log-line{margin-bottom:1px}
.controls{display:flex;gap:4px;margin-bottom:8px;flex-shrink:0}
.controls button{flex:1;padding:16px 8px;background:#1a8c3a;color:#fff;border:none;border-radius:8px;font-weight:bold;font-size:1em;cursor:pointer;transition:all .2s;box-shadow:0 2px 8px rgba(0,0,0,.3)}
.controls button:active:not(:disabled){background:#0d5f1f;transform:scale(.96)}
.controls button:disabled{background:#555;opacity:.5;cursor:not-allowed}
.swap-section{background:linear-gradient(135deg,#ff9800,#c86432);border:2px solid #fff;padding:12px;border-radius:8px;margin:8px 0;display:none}
.swap-section.active{display:block}
.swap-title{font-size:1em;font-weight:bold;color:#fff;margin-bottom:4px;text-align:center}
.swap-role{font-size:.85em;color:#ffe0b2;text-align:center;margin-bottom:8px;font-weight:bold}
.swap-instruction{font-size:.75em;color:#fff;margin-bottom:8px;text-align:center;background:rgba(0,0,0,.2);padding:6px;border-radius:4px}
.swap-card-display{display:flex;flex-wrap:wrap;gap:3px;justify-content:center;margin-bottom:8px;background:rgba(0,0,0,.2);padding:8px;border-radius:6px}
.swap-card{width:38px;height:56px;background:linear-gradient(135deg,#fff,#f0f0f0);border:2px solid #333;border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:2px;cursor:pointer;transition:all .2s}
.swap-card.red{color:#d32f2f}
.swap-card.black{color:#1a1a1a}
.swap-card.selected{background:linear-gradient(135deg,#51cf66,#1a8c3a);color:#fff;border-color:#ffeb3b;transform:scale(1.1);box-shadow:0 2px 8px rgba(255,235,59,.8)}
.swap-card-rank{font-size:10px;font-weight:bold}
.swap-card-suit{font-size:11px}
.swap-buttons{display:flex;gap:6px}
.swap-buttons button{flex:1;padding:12px;background:#fff;color:#ff9800;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:.95em;box-shadow:0 2px 4px rgba(0,0,0,.3)}
.swap-buttons button:active{background:#ffe0b2;transform:scale(.96)}
.neutral-section{background:linear-gradient(135deg,#4caf50,#388e3c);border:2px solid #fff;padding:12px;border-radius:8px;margin:8px 0;display:none;text-align:center}
.neutral-section.active{display:block}
.neutral-title{font-size:1em;font-weight:bold;color:#fff;margin-bottom:6px}
.neutral-role{font-size:.85em;color:#c8e6c9;margin-bottom:10px}
.neutral-message{font-size:.75em;color:#fff;background:rgba(0,0,0,.2);padding:8px;border-radius:4px;margin-bottom:10px}
.neutral-ready-btn{width:100%;padding:14px;background:#fff;color:#4caf50;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:1em;box-shadow:0 2px 4px rgba(0,0,0,.3)}
.neutral-ready-btn:active{background:#c8e6c9;transform:scale(.96)}
.sound-toggle{position:fixed;top:50px;right:10px;width:45px;height:45px;background:#1a8c3a;border:none;border-radius:50%;color:#fff;font-size:20px;cursor:pointer;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.3)}
.sound-toggle.muted{background:#555}
#setupSection{padding:12px;background:rgba(255,255,255,.08);border-radius:10px;margin-bottom:8px}
#setupSection input,#setupSection select{width:100%;padding:10px;margin-bottom:8px;border:1px solid #444;border-radius:6px;background:#1a1a1a;color:#fff}
#setupSection button{width:100%;padding:12px;margin-bottom:6px;background:#1a8c3a;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
#setupSection button:active{background:#0d5f1f}
.version{position:fixed;top:4px;right:4px;background:#1a8c3a;padding:3px 8px;border-radius:10px;font-size:.7em;z-index:100}
@media (min-width:768px){
html,body{overflow:auto}
.game{max-width:1400px;width:100%;margin:0 auto;padding:30px;height:auto;min-height:100vh}
.top-bar{padding:20px;margin-bottom:20px;border-radius:12px}
.current-turn{font-size:2em;margin-bottom:10px}
.role-display{font-size:1.5em;padding:12px;margin-bottom:12px}
.players-row{gap:16px;max-height:none;flex-wrap:wrap;justify-content:center}
.player-card{padding:16px 20px;min-width:180px;font-size:1.3em;border-left-width:5px;border-radius:10px}
.player-name{font-size:1.4em}
.player-info{font-size:1.1em;margin-top:6px}
.table-section{padding:40px;margin-bottom:30px;min-height:280px;border-radius:12px}
.pile-title{font-size:1.4em;margin-bottom:20px}
.pile-display{gap:16px;min-height:170px}
.pile-card{width:110px;height:165px;font-size:24px;border-radius:8px;border-width:3px;padding:8px}
.hand-area{padding:20px;margin-bottom:20px;max-height:420px;border-radius:12px}
.hand-title{font-size:1.4em;margin-bottom:12px}
.hand-display{gap:12px}
.card{width:90px;height:130px;border-radius:8px;padding:6px;border-width:3px}
.card.selected{transform:translateY(-15px)}
.card-rank{font-size:22px}
.card-suit{font-size:26px}
.log-section{padding:16px;height:140px;font-size:1em;margin-bottom:20px;border-radius:10px}
.controls{gap:20px;margin-bottom:25px}
.controls button{padding:24px 16px;font-size:1.4em;border-radius:12px}
.controls button:hover:not(:disabled){background:#176b2b;transform:translateY(-2px)}
.swap-section{padding:30px;margin:25px 0;border-radius:12px}
.swap-title{font-size:1.8em;margin-bottom:12px}
.swap-role{font-size:1.4em;margin-bottom:16px}
.swap-instruction{font-size:1.3em;padding:14px;margin-bottom:16px}
.swap-card-display{gap:12px;padding:20px}
.swap-card{width:90px;height:130px;border-radius:8px;border-width:3px;padding:6px}
.swap-card-rank{font-size:22px}
.swap-card-suit{font-size:26px}
.swap-buttons{gap:16px}
.swap-buttons button{padding:20px;font-size:1.4em}
.neutral-section{padding:30px;margin:25px 0;border-radius:12px}
.neutral-title{font-size:1.8em;margin-bottom:14px}
.neutral-role{font-size:1.4em;margin-bottom:18px}
.neutral-message{font-size:1.3em;padding:16px;margin-bottom:18px}
.neutral-ready-btn{padding:22px;font-size:1.4em}
#setupSection{padding:30px;margin-bottom:25px;border-radius:12px}
#setupSection input,#setupSection select{padding:18px;margin-bottom:16px;font-size:1.3em;border-radius:8px}
#setupSection button{padding:20px;margin-bottom:14px;font-size:1.3em;border-radius:8px}
.sound-toggle{top:80px;right:30px;width:70px;height:70px;font-size:32px}
.version{top:15px;right:15px;padding:8px 16px;font-size:1.1em}
}
</style>
</head>
<body>
<button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</button>
<div class="version">v1.6.55</div>
<div class="game">
<div id="setupSection">
<input type="text" id="playerName" placeholder="Your Name">
<select id="numPlayers">
<option value="2">2 Players</option>
<option value="3">3 Players</option>
<option value="4" selected>4 Players</option>
<option value="5">5 Players</option>
<option value="6">6 Players</option>
<option value="7">7 Players</option>
<option value="8">8 Players</option>
</select>
<select id="numCPU">
<option>0 CPU</option>
<option>1 CPU</option>
<option selected>2 CPU</option>
<option>3 CPU</option>
<option>4 CPU</option>
<option>5 CPU</option>
<option>6 CPU</option>
<option>7 CPU</option>
</select>
<button onclick="createGame()">üéÆ CREATE GAME</button>
<input id="roomCode" placeholder="Room Code">
<button onclick="joinGame()">üö™ JOIN GAME</button>
<button onclick="startGame()">‚ñ∂Ô∏è START GAME</button>
</div>
<div class="top-bar">
<div class="current-turn" id="currentTurn">Waiting...</div>
<div class="role-display" id="roleDisplay"></div>
<div class="players-row" id="playersRow"></div>
</div>
<div class="table-section">
<div class="pile-title">‚ô†Ô∏è TABLE</div>
<div class="pile-display" id="pileDisplay"></div>
</div>
<div class="hand-area" id="handArea">
<div class="hand-title">üÉè YOUR HAND</div>
<div class="hand-display" id="handDisplay"></div>
</div>
<div class="swap-section" id="swapSection">
<div class="swap-title">üîÑ CARD SWAP PHASE</div>
<div class="swap-role" id="swapRole"></div>
<div class="swap-instruction" id="swapInstruction"></div>
<div class="swap-card-display" id="swapCardDisplay"></div>
<div class="swap-buttons">
<button onclick="submitSwap()">‚úì SUBMIT SWAP</button>
<button onclick="clearSwapSelection()">‚úï CLEAR</button>
</div>
</div>
<div class="neutral-section" id="neutralSection">
<div class="neutral-title">üë§ NO SWAP REQUIRED</div>
<div class="neutral-role" id="neutralRole"></div>
<div class="neutral-message">You're a Neutral player - no card swaps needed!<br>Review your hand and click READY when you're set.</div>
<button class="neutral-ready-btn" onclick="submitReady()">‚úì READY</button>
</div>
<div class="log-section" id="log"></div>
<div class="controls">
<button id="playBtn" onclick="playCards()">‚ñ∂ PLAY</button>
<button onclick="clearSelection()">‚úï CLEAR</button>
<button id="passBtn" onclick="passTurn()">‚è≠ PASS</button>
</div>
</div>
<script>
let socket,myId,room,hand=[],sel=new Set(),swapSel=new Set();
let processing=false,soundEnabled=true;
let lastLogLength=0;
let isMyTurn=false;
let currentPhase='waiting';
let myRole='';
let swapInfo=null;
let playerName='';
function playSound(type){if(!soundEnabled)return;const ctx=new(window.AudioContext||window.webkitAudioContext)();const osc=ctx.createOscillator();const env=ctx.createGain();osc.connect(env);env.connect(ctx.destination);if(type==='play'){osc.frequency.value=800;env.gain.setValueAtTime(.3,ctx.currentTime);env.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.1);osc.start(ctx.currentTime);osc.stop(ctx.currentTime+.1);}else if(type==='pass'){osc.frequency.value=600;env.gain.setValueAtTime(.2,ctx.currentTime);env.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.08);osc.start(ctx.currentTime);osc.stop(ctx.currentTime+.08);}else if(type==='yourturn'){osc.frequency.value=1200;env.gain.setValueAtTime(.4,ctx.currentTime);env.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.15);osc.start(ctx.currentTime);osc.stop(ctx.currentTime+.15);}}
function toggleSound(){soundEnabled=!soundEnabled;document.getElementById('soundToggle').textContent=soundEnabled?'üîä':'üîá';document.getElementById('soundToggle').classList.toggle('muted');}
function log(m){const d=document.getElementById('log');const line=document.createElement('div');line.className='log-line';const t=new Date().toLocaleTimeString().substring(0,8);line.textContent=`[${t}] ${m}`;d.appendChild(line);d.scrollTop=d.scrollHeight;if(d.children.length>25)d.removeChild(d.children[0]);}
function syncGameLog(gameLog){if(!gameLog||gameLog.length===lastLogLength)return;for(let i=lastLogLength;i<gameLog.length;i++){const entry=gameLog[i];if(entry.msg){log(entry.msg);}}lastLogLength=gameLog.length;}
function getSwapInstructions(role,count){if(role==='President')return`You're PRESIDENT! Select your ${count} WORST card(s) to give away.`;if(role==='Vice President')return`You're VICE PRESIDENT! Select your ${count} worst card(s) to give away.`;if(role==='Asshole')return`You're ASSHOLE! Select your ${count} BEST card(s) to give away.`;if(role==='Vice Asshole')return`You're VICE ASSHOLE! Select your ${count} best card(s) to give away.`;return`Select ${count} card(s) to swap.`;}
function getRoleAbbr(role){if(!role)return'';if(role==='President')return'Pre';if(role==='Vice President')return'VP';if(role==='Neutral')return'Neu';if(role==='Vice Asshole')return'VA';if(role==='Asshole')return'Ass';return role.substring(0,3);}
function rejoinRoom(){if(room&&playerName){log('üîÑ Rejoining room...');socket.emit('rejoin-game',{roomCode:room,playerName:playerName});}}
function autoConnect(){socket=io(window.location.origin,{reconnection:true,reconnectionDelay:1000,reconnectionAttempts:10,transports:['websocket','polling']});socket.on('connect',()=>{myId=socket.id;log('‚úÖ Connected');if(room&&playerName){setTimeout(rejoinRoom,500);}});socket.on('disconnect',()=>log('‚ö†Ô∏è Reconnecting...'));socket.on('game-created',d=>{room=d.roomCode;document.getElementById('roomCode').value=d.roomCode;log('Room: '+d.roomCode);});socket.on('game-started',()=>{log('üéÆ Started!');document.getElementById('setupSection').style.display='none';});socket.on('game-state-update',s=>{currentPhase=s.phase;renderPlayers(s);renderPile(s);myRole=s.roles[myId]||'';const roleText=myRole?`Your Role: ${myRole}`:'';document.getElementById('roleDisplay').textContent=roleText;document.getElementById('currentTurn').textContent=s.currentPlayerName+(s.isYourTurn?' (YOUR TURN)':'');const wasMyTurn=isMyTurn;isMyTurn=s.isYourTurn;if(isMyTurn&&!wasMyTurn)playSound('yourturn');syncGameLog(s.gameLog);if(s.phase==='swapping'){const swap=s.swapRequired;if(swap&&s.players){const me=s.players.find(p=>p.id===myId);if(me&&me.hand){hand=me.hand;swapInfo=swap;document.getElementById('swapSection').classList.add('active');document.getElementById('neutralSection').classList.remove('active');document.getElementById('handArea').style.display='none';document.getElementById('swapRole').textContent=`Role: ${myRole}`;document.getElementById('swapInstruction').textContent=getSwapInstructions(myRole,swap.count);renderSwapCards();}}else{document.getElementById('swapSection').classList.remove('active');if(myRole&&myRole==='Neutral'){document.getElementById('neutralSection').classList.add('active');document.getElementById('neutralRole').textContent=`You are: ${myRole}`;document.getElementById('handArea').style.display='block';if(s.players){const m=s.players.find(p=>p.id===myId);if(m&&m.hand){hand=m.hand;renderHand();}}}else{document.getElementById('neutralSection').classList.remove('active');document.getElementById('handArea').style.display='block';document.getElementById('handDisplay').innerHTML='<span style="color:#888">Waiting for swaps...</span>';}}document.getElementById('playBtn').disabled=true;document.getElementById('passBtn').disabled=true;}else{document.getElementById('swapSection').classList.remove('active');document.getElementById('neutralSection').classList.remove('active');document.getElementById('handArea').style.display='block';if(s.players){const m=s.players.find(p=>p.id===myId);if(m&&m.hand){hand=m.hand;renderHand();}}document.getElementById('playBtn').disabled=!s.isYourTurn;document.getElementById('passBtn').disabled=!s.lastPlay||s.lastPlay.type==='none'||!s.isYourTurn;}});socket.on('error',d=>log('‚ùå '+d.message));}
function renderSwapCards(){const d=document.getElementById('swapCardDisplay');if(!hand||hand.length===0){d.innerHTML='<span style="color:#fff">Loading cards...</span>';return;}d.innerHTML='';hand.forEach((c,i)=>{const card=document.createElement('div');card.className='swap-card '+((c.suit==='H'||c.suit==='D')?'red':'black')+(swapSel.has(i)?' selected':'');const su={H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[c.suit];card.innerHTML='<span class="swap-card-rank">'+c.rank+'</span><span class="swap-card-suit">'+su+'</span>';card.onclick=()=>{if(swapInfo&&swapSel.size>=swapInfo.count&&!swapSel.has(i))return;swapSel.has(i)?swapSel.delete(i):swapSel.add(i);renderSwapCards();};d.appendChild(card);});}
function renderPlayers(s){const list=document.getElementById('playersRow');list.innerHTML='';s.players.forEach(p=>{const d=document.createElement('div');d.className='player-card'+(p.id===s.currentPlayerId?' active':'')+(p.id===myId?' you':'');const roleAbbr=getRoleAbbr(s.roles[p.id]);const role=roleAbbr?' ('+roleAbbr+')':'';d.innerHTML='<div class="player-name">'+p.name+role+(p.isCPU?'<span style="background:#9775fa;padding:1px 3px;border-radius:3px;font-size:.6em;margin-left:2px">CPU</span>':'')+'</div><div class="player-info">'+p.handSize+' cards</div>';list.appendChild(d);});}
function renderPile(s){const p=document.getElementById('pileDisplay');if(!s.lastPlay||!s.lastPlay.cards||s.lastPlay.cards.length===0){p.innerHTML='<span style="color:#888;font-size:.8em">Clear</span>';return;}p.innerHTML='';s.lastPlay.cards.forEach(c=>{const d=document.createElement('div');d.className='pile-card '+((c.suit==='H'||c.suit==='D')?'red':'black');const su={H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[c.suit];d.textContent=c.rank+su;p.appendChild(d);});}
function renderHand(){const h=document.getElementById('handDisplay');if(!hand||hand.length===0){h.innerHTML='<span style="color:#888">No cards</span>';return;}h.innerHTML='';hand.forEach((c,i)=>{const d=document.createElement('div');d.className='card '+((c.suit==='H'||c.suit==='D')?'red':'black')+(sel.has(i)?' selected':'');const su={H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[c.suit];d.innerHTML='<span class="card-rank">'+c.rank+'</span><span class="card-suit">'+su+'</span>';d.onclick=()=>{sel.has(i)?sel.delete(i):sel.add(i);renderHand();};h.appendChild(d);});}
function clearSelection(){sel.clear();renderHand();}
function clearSwapSelection(){swapSel.clear();renderSwapCards();}
function createGame(){const n=document.getElementById('playerName').value||'Player';playerName=n;const np=parseInt(document.getElementById('numPlayers').value);const nc=parseInt(document.getElementById('numCPU').value);if(1+nc>np){alert('Too many CPUs!');return;}socket.emit('create-game',{playerName:n,options:{num_players:np,numCPU:nc}});}
function joinGame(){const c=document.getElementById('roomCode').value.toUpperCase().trim();if(!c){alert('Please enter a room code');return;}const n=document.getElementById('playerName').value||'Player';playerName=n;room=c;log('Joining room: '+c);socket.emit('join-game',{roomCode:c,playerName:n});}
function startGame(){if(room)socket.emit('start-game',{roomCode:room});}
function playCards(){if(processing||!socket||!room||sel.size===0)return;processing=true;playSound('play');socket.emit('play-cards',{roomCode:room,cardIndices:Array.from(sel).sort((a,b)=>a-b)});sel.clear();setTimeout(()=>processing=false,200);}
function passTurn(){if(processing||!socket||!room)return;processing=true;playSound('pass');socket.emit('pass-turn',{roomCode:room});setTimeout(()=>processing=false,200);}
function submitSwap(){if(!swapInfo||swapSel.size!==swapInfo.count){log(`‚ö†Ô∏è Select ${swapInfo?swapInfo.count:'?'} card(s)`);return;}processing=true;log('Submitting swap...');socket.emit('submit-swap',{roomCode:room,cardIndices:Array.from(swapSel).sort((a,b)=>a-b)});swapSel.clear();setTimeout(()=>processing=false,500);}
function submitReady(){if(processing)return;processing=true;log('Ready - checking swaps...');socket.emit('ready-neutral',{roomCode:room});setTimeout(()=>processing=false,500);}
window.addEventListener('load',autoConnect);
</script>
</body>
</html>