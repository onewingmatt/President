<!DOCTYPE html><html><head><meta charset="UTF-8"><title>President</title><script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script><style>*{box-sizing:border-box;margin:0;padding:0}html,body{width:100%;height:100%}body{font-family:Arial,sans-serif;background:#0d2818;color:white;padding:8px;overflow:hidden}.version-badge{position:fixed;top:8px;right:8px;background:#1a8c3a;padding:4px 8px;border-radius:12px;font-size:.7em;font-weight:bold;z-index:1000}.audio-controls{position:fixed;top:8px;right:90px;display:flex;align-items:center;gap:8px;z-index:1000}.sound-toggle{background:#1a8c3a;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.2em;transition:all .2s}.sound-toggle:hover{background:#0d5f1f}.volume-slider{width:60px;height:6px;border-radius:3px;background:rgba(255,255,255,.3);cursor:pointer;-webkit-appearance:none;appearance:none}.connection-bar{position:fixed;top:0;left:0;right:0;height:2px;background:#51cf66;z-index:2000;transition:background .2s}.connection-bar.warning{background:#ff9800}.connection-bar.error{background:#d32f2f}.game-container{width:100%;height:100%;display:flex;flex-direction:column}.main-content{display:flex;gap:8px;flex:1;overflow:hidden;flex-wrap:wrap}@media(max-width:768px){.main-content{flex-direction:column}}.left-panel{flex:1;display:flex;flex-direction:column;gap:8px;overflow-y:auto;min-width:200px}.right-panel{width:280px;display:flex;flex-direction:column;gap:8px;overflow:hidden}@media(max-width:768px){.right-panel{width:100%;max-height:150px}}.table-section{background:linear-gradient(135deg,#0d5f1f,#1a8c3a);padding:12px;border-radius:12px;flex:1;display:flex;flex-direction:column;box-shadow:0 4px 12px rgba(0,0,0,.3)}.table-title{font-size:.85em;font-weight:bold;margin-bottom:6px;color:#aaa}.table-info{font-size:.8em;color:#ffb74d;margin-bottom:8px;height:20px}.pile-container{background:rgba(0,0,0,.3);border-radius:10px;padding:12px;border:2px dashed rgba(255,255,255,.2);flex:1;display:flex;align-items:center;justify-content:center;min-height:80px}.pile-cards{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}.pile-card{width:45px;height:70px;background:linear-gradient(135deg,#fff,#f0f0f0);border:2px solid #333;border-radius:5px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:12px;box-shadow:0 2px 8px rgba(0,0,0,.4)}.pile-card.red{color:#d32f2f}.pile-card.black{color:#1a1a1a}.pile-empty{color:#666;font-size:.9em}.hand-section{background:rgba(255,255,255,.05);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.1);flex:1;display:flex;flex-direction:column}.hand-title{font-size:.8em;font-weight:bold;margin-bottom:6px;color:#aaa}.hand-display{display:flex;flex-wrap:wrap;gap:6px;flex:1;overflow-y:auto}.card{width:40px;height:65px;background:linear-gradient(135deg,#fff,#e8e8e8);border:1px solid #222;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:bold;font-size:11px;transition:all .2s;box-shadow:0 2px 6px rgba(0,0,0,.3)}.card.red{color:#d32f2f}.card.black{color:#1a1a1a}.card:hover{transform:translateY(-4px)}.card.selected{background:linear-gradient(135deg,#1a8c3a,#0d5f1f);color:white;transform:translateY(-6px);border-color:#fff}.buttons{display:flex;gap:4px;margin-top:8px}.buttons button{flex:1;padding:6px;background:#1a8c3a;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:.8em;transition:all .2s}.buttons button:hover:not(:disabled){background:#0d5f1f}.buttons button:disabled{background:#555;cursor:not-allowed;opacity:.5}.sidebar{display:flex;flex-direction:column;gap:8px;height:100%;overflow:hidden}.card-section{background:rgba(255,255,255,.05);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.1);flex:1;display:flex;flex-direction:column;min-height:0;overflow:hidden}.section-title{font-size:.8em;font-weight:bold;color:#aaa;margin-bottom:6px}.setup-section{flex:1}#setup-container{display:flex;flex-direction:column;gap:6px}input,select{padding:6px;border:1px solid #444;border-radius:5px;background:#1a1a1a;color:white;font-size:.8em;width:100%}input::placeholder{color:#666}label{font-size:.8em;color:#aaa;display:flex;align-items:center;gap:4px}label input{margin:0;width:auto}.setup-hidden{display:none}.players-list{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:4px;font-size:.8em}.player-item{padding:6px;background:rgba(255,255,255,.08);border-left:3px solid #666;border-radius:4px;color:white;display:flex;justify-content:space-between;align-items:center}.player-item.current-turn{border-left-color:#ff6b6b;background:rgba(255,107,107,.15);font-weight:bold}.player-item.cpu{border-left-color:#9775fa}.player-item.finished{opacity:.6}.badges{display:flex;gap:2px;font-size:.65em}.cpu-badge{background:#9775fa;color:white;padding:2px 5px;border-radius:3px}.role-badge{background:#ff9800;color:white;padding:2px 5px;border-radius:3px}.finish-badge{background:#51cf66;color:white;padding:2px 5px;border-radius:3px}#log{flex:1;background:#1a1a1a;color:#00ff00;padding:8px;border-radius:8px;overflow-y:auto;font-family:'Courier New',monospace;font-size:.75em;line-height:1.2;border:1px solid #333}.role-display{background:rgba(255,152,0,.2);border:2px solid #ff9800;padding:12px;border-radius:10px;text-align:center;margin-bottom:8px}.role-display h3{font-size:.95em;margin-bottom:6px;color:#fff}.role-display .description{font-size:.8em;color:#ffb74d;margin-bottom:6px}.role-display .instruction{background:rgba(0,0,0,.5);padding:8px;border-radius:6px;font-size:.75em;color:#fff}#swapBanner{background:linear-gradient(135deg,#ff9800,#f57c00);padding:12px;border-radius:10px;text-align:center;border:2px solid #fff;margin-bottom:8px}#swapBanner h2{font-size:1em;margin:0 0 4px 0}#swapBanner p{font-size:.8em;margin:0}#yourTurnBanner{background:linear-gradient(135deg,#51cf66,#2f9e44);padding:8px;border-radius:8px;text-align:center;font-weight:bold;font-size:.9em;margin-bottom:8px}#errorBanner{background:linear-gradient(135deg,#ff6b6b,#e03131);padding:8px;border-radius:8px;text-align:center;font-weight:bold;font-size:.8em;display:none;margin-bottom:8px}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}#errorBanner.show{animation:shake .4s}</style></head><body><div class="connection-bar" id="connectionBar"></div><div class="version-badge">v1.6.22</div><div class="audio-controls"><input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50"><div class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</div></div><div class="game-container"><div class="main-content"><div class="left-panel"><div id="banners"></div><div id="roleInfo"></div><div id="swapBanner" style="display:none;"><h2>üîÑ SWAP CARDS</h2><p id="swapInstructions"></p></div><div id="yourTurnBanner" style="display:none;">üîî YOUR TURN!</div><div id="errorBanner"></div><div class="table-section"><div class="table-title">‚ô†Ô∏è TABLE</div><div class="table-info" id="currentPlayerDisplay"></div><div class="pile-container"><div class="pile-cards" id="pileCards"><span class="pile-empty">Waiting...</span></div></div></div><div class="hand-section"><div class="hand-title" id="handTitle">üÉè YOUR HAND</div><div class="hand-display" id="handDisplay"><span style="color:#888;">Loading...</span></div><div class="buttons"><button id="playBtn" onclick="playSelectedCards()" disabled>‚ñ∂ PLAY</button><button onclick="clearSelection()">‚úï CLEAR</button><button id="passBtn" onclick="passTurn()" disabled>‚è≠ PASS</button></div></div></div><div class="right-panel"><div class="card-section setup-section"><div class="section-title">üé≤ SETUP</div><div id="setup-container"></div></div><div class="card-section"><div class="section-title">üë• PLAYERS</div><div class="players-list" id="playersList"><span style="color:#888;font-size:.75em;">No players</span></div></div><div class="card-section"><div class="section-title">üìú LOG</div><div id="log"></div></div></div></div></div><script>const SERVER_URL='https://president.fly.dev';let socket,myId,room,hand=[],sel=new Set(),swapReq=null,lastPhase='waiting';let audioContext=null,processing=false;let soundEnabled=localStorage.getItem('soundEnabled')!=='false';let soundVolume=parseFloat(localStorage.getItem('soundVolume')||'50')/100;let connectionAttempts=0;function initAudio(){if(audioContext)return;try{audioContext=new(window.AudioContext||window.webkitAudioContext)();}catch(e){}}function playSound(freq=800,duration=.2){if(!soundEnabled||!audioContext)return;try{const osc=audioContext.createOscillator(),gain=audioContext.createGain();osc.connect(gain);gain.connect(audioContext.destination);osc.frequency.value=freq;osc.type='sine';gain.gain.setValueAtTime(soundVolume,audioContext.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+duration);osc.start(audioContext.currentTime);osc.stop(audioContext.currentTime+duration);}catch(e){}}function toggleSound(){soundEnabled=!soundEnabled;localStorage.setItem('soundEnabled',soundEnabled);document.getElementById('soundToggle').textContent=soundEnabled?'üîä':'üîá';log(soundEnabled?'üîä Sound ON':'üîá Sound OFF');}function updateVolume(val){soundVolume=val/100;localStorage.setItem('soundVolume',val);}function log(m){const d=document.getElementById('log');if(d){d.innerHTML+=`${m}<br>`;d.scrollTop=d.scrollHeight;}}function showSetup(){const c=document.getElementById('setup-container');c.innerHTML='<input type="text" id="playerName" placeholder="Your Name"><div style="display:flex;gap:4px;margin:4px 0;"><label><input type="checkbox" id="addCPU" checked style="margin:0;width:auto;"> CPU</label><select id="numCPU" style="flex:1;"><option>1</option><option>2</option><option selected>3</option></select></div><button id="createBtn" onclick="createGame()" disabled style="width:100%;padding:8px;margin-bottom:4px;">CREATE</button><input id="roomCode" placeholder="Room Code"><button id="joinBtn" onclick="joinGame()" disabled style="width:100%;padding:8px;margin-bottom:4px;">JOIN</button><button id="startBtn" onclick="startGame()" disabled style="width:100%;padding:8px;">START</button>';}function hideSetup(){document.getElementById('setup-container').innerHTML='';}function getRoleInfo(role){const info={President:{emoji:'üëë',desc:'Give 2 WORST cards'},
'Vice President':{emoji:'üíé',desc:'Give 1 WORST card'},Asshole:{emoji:'üí©',desc:'Pick 2 BEST cards'},
'Vice Asshole':{emoji:'üí£',desc:'Pick 1 BEST card'},Neutral:{emoji:'üôÇ',desc:'No swap'}};return info[role]||{emoji:'üé¥',desc:''};}document.getElementById('volumeSlider').addEventListener('input',e=>updateVolume(e.target.value));document.getElementById('volumeSlider').value=soundVolume*100;function updateConnectionBar(status){const bar=document.getElementById('connectionBar');bar.className='connection-bar'+(status==='reconnecting'?' warning':status==='error'?' error':'');}function autoConnect(){initAudio();if(!socket){socket=io(SERVER_URL,{reconnection:true,reconnectionDelay:300,reconnectionDelayMax:1000,reconnectionAttempts:50,timeout:2000,transports:['websocket','polling']});socket.on('connect',()=>{myId=socket.id;updateConnectionBar('connected');['createBtn','joinBtn','startBtn','playBtn','passBtn'].forEach(id=>{const btn=document.getElementById(id);if(btn)btn.disabled=false;});log('‚úÖ Ready!');playSound(800,.15);showSetup();});socket.on('disconnect',()=>{connectionAttempts++;updateConnectionBar('reconnecting');});socket.on('connect_error',()=>{updateConnectionBar('error');if(connectionAttempts>5)log('‚ö†Ô∏è Connection unstable');});socket.on('game-created',d=>{room=d.roomCode;document.getElementById('roomCode').value=d.roomCode;log('üìç Room: '+d.roomCode);playSound(600,.15);});socket.on('game-started',()=>{log('üéÆ Game started!');playSound(1000,.2);hideSetup();});socket.on('game-state-update',s=>{if(s.phase!==lastPhase){clearSelection();lastPhase=s.phase;}const pl=document.getElementById('playersList');if(pl&&s.players){pl.innerHTML='';s.players.forEach(p=>{const d=document.createElement('div');d.className='player-item'+(p.id===s.currentPlayerId?' current-turn':'')+(p.isCPU?' cpu':'')+(p.finished?' finished':'');let html='<span>'+p.name;if(p.role)html+='<span class="role-badge">'+p.role.substring(0,1)+'</span>';if(p.isCPU)html+='<span class="cpu-badge">CPU</span>';if(p.finished)html+='<span class="finish-badge">#'+p.finishPosition+'</span>';html+='</span><span>'+p.handSize+'üÉè</span>';d.innerHTML=html;pl.appendChild(d);});}document.getElementById('currentPlayerDisplay').textContent=s.currentPlayerName+(s.isYourTurn?' (YOU)':'');if(s.isYourTurn){document.getElementById('yourTurnBanner').style.display='block';playSound(1200,.2);}else document.getElementById('yourTurnBanner').style.display='none';if(s.phase==='swapping'&&s.swapRequired){const info=getRoleInfo(s.roles[myId]);document.getElementById('swapBanner').style.display='block';document.getElementById('swapInstructions').textContent='Select '+s.swapRequired.count+' card'+(s.swapRequired.count>1?'s':'');document.getElementById('roleInfo').innerHTML='<div class="role-display"><h3>'+info.emoji+' '+s.roles[myId]+'</h3><div class="description">'+info.desc+'</div></div>';document.getElementById('playBtn').onclick=submitSwap;document.getElementById('playBtn').textContent='üîÑ SWAP';}else{document.getElementById('swapBanner').style.display='none';document.getElementById('roleInfo').innerHTML='';document.getElementById('playBtn').onclick=playSelectedCards;document.getElementById('playBtn').textContent='‚ñ∂ PLAY';}const m=s.players.find(p=>p.id===myId);if(m&&m.hand){hand=m.hand;render();}const pile=document.getElementById('pileCards');if(!s.lastPlay||!s.lastPlay.cards||s.lastPlay.cards.length===0)pile.innerHTML='<span class="pile-empty">Clear</span>';else{pile.innerHTML='';s.lastPlay.cards.forEach(card=>{const d=document.createElement('div');d.className='pile-card '+((card.suit==='H'||card.suit==='D')?'red':'black');d.textContent=card.rank+({H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[card.suit]);pile.appendChild(d);});}document.getElementById('passBtn').disabled=!s.lastPlay||s.lastPlay.type==='none'||!s.isYourTurn;processing=false;});socket.on('error',d=>{log('‚ùå '+d.message);playSound(300,.2);});}}function createGame(){const name=document.getElementById('playerName').value||'Player'+Math.floor(Math.random()*1000);socket.emit('create-game',{playerName:name,options:{num_players:4,addCPU:document.getElementById('addCPU').checked,numCPU:parseInt(document.getElementById('numCPU').value)}});}function joinGame(){const c=document.getElementById('roomCode').value.toUpperCase().trim();if(!c||c.length!==6){log('‚ùå6-char code');return;}room=c;const name=document.getElementById('playerName').value||'Player'+Math.floor(Math.random()*1000);socket.emit('join-game',{roomCode:c,playerName:name});log('Joining '+c);}function startGame(){socket&&room&&socket.emit('start-game',{roomCode:room});}function render(){const h=document.getElementById('handDisplay');if(!h)return;h.innerHTML='';if(!hand||hand.length===0){h.innerHTML='<span style="color:#888;">No cards</span>';return;}hand.forEach((c,i)=>{const d=document.createElement('div');d.className='card '+((c.suit==='H'||c.suit==='D')?'red':'black')+(sel.has(i)?' selected':'');d.textContent=c.rank+({H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[c.suit]);d.onclick=()=>{if(swapReq&&sel.size>=swapReq.count&&!sel.has(i))return;sel.has(i)?sel.delete(i):sel.add(i);playSound(600,.1);render();if(swapReq)document.getElementById('playBtn').disabled=sel.size!==swapReq.count;};h.appendChild(d);});}function clearSelection(){sel.clear();render();}function playSelectedCards(){if(processing||!socket||!room||sel.size===0)return;processing=true;socket.emit('play-cards',{roomCode:room,cardIndices:Array.from(sel).sort((a,b)=>a-b)});sel.clear();}function passTurn(){if(processing||!socket||!room)return;processing=true;socket.emit('pass-turn',{roomCode:room});}function submitSwap(){if(processing||!socket||!room||!swapReq||sel.size!==swapReq.count)return;processing=true;socket.emit('submit-swap',{roomCode:room,cardIndices:Array.from(sel).sort((a,b)=>a-b)});sel.clear();log('‚úÖ Swap!');playSound(1000,.2);}window.addEventListener('load',()=>{updateVolume(soundVolume*100);autoConnect();});</script></body></html>