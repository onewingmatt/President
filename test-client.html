<!DOCTYPE html><html><head><meta charset="UTF-8"><title>President</title><script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script><style>*{box-sizing:border-box;margin:0;padding:0}html,body{width:100%;height:100%;overflow:hidden}body{font-family:Arial,sans-serif;background:#0d2818;color:white;padding:0;overflow:hidden}.version-badge{position:fixed;top:8px;right:8px;background:#1a8c3a;padding:4px 8px;border-radius:12px;font-size:.7em;font-weight:bold;z-index:1000}.audio-controls{position:fixed;top:8px;right:90px;display:flex;align-items:center;gap:8px;z-index:1000}.sound-toggle{background:#1a8c3a;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.2em;transition:all .2s}.sound-toggle:hover{background:#0d5f1f}.volume-slider{width:60px;height:6px;border-radius:3px;background:rgba(255,255,255,.3);cursor:pointer;-webkit-appearance:none;appearance:none}.connection-bar{position:fixed;top:0;left:0;right:0;height:2px;background:#51cf66;z-index:2000}.game-container{width:100vw;height:100vh;display:flex;flex-direction:column;padding:30px 8px 8px 8px}.game-area{flex:1;display:flex;flex-direction:column;gap:8px;overflow:hidden}.pile-section{background:linear-gradient(135deg,#0d5f1f,#1a8c3a);padding:12px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.3)}.pile-title{font-size:.85em;font-weight:bold;margin-bottom:4px;color:#aaa}.current-player{font-size:.9em;color:#ffb74d;margin-bottom:8px;font-weight:bold}.pile-cards{display:flex;gap:6px;flex-wrap:wrap;align-items:center;justify-content:center;min-height:70px}.pile-card{width:38px;height:60px;background:linear-gradient(135deg,#fff,#f0f0f0);border:2px solid #333;border-radius:4px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:10px;box-shadow:0 2px 6px rgba(0,0,0,.4);flex-shrink:0}.pile-card.red{color:#d32f2f}.pile-card.black{color:#1a1a1a}.pile-empty{color:#666;font-size:.9em}.hand-section{background:rgba(255,255,255,.05);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);flex:1;display:flex;flex-direction:column;overflow:hidden}.hand-title{font-size:.85em;font-weight:bold;margin-bottom:8px;color:#aaa}.hand-display{display:flex;flex-wrap:wrap;gap:8px;flex:1;overflow-y:auto;padding-right:4px;align-content:flex-start}.card{width:50px;height:78px;background:linear-gradient(135deg,#fff,#e8e8e8);border:1px solid #222;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:bold;font-size:13px;transition:all .2s;box-shadow:0 2px 8px rgba(0,0,0,.3);flex-shrink:0;user-select:none}.card.red{color:#d32f2f}.card.black{color:#1a1a1a}.card:active{transform:scale(.95)}.card:hover{transform:translateY(-6px)}.card.selected{background:linear-gradient(135deg,#1a8c3a,#0d5f1f);color:white;transform:translateY(-8px);border-color:#fff;box-shadow:0 4px 12px rgba(26,140,58,.6)}.controls{display:flex;gap:6px;margin-top:12px}.controls button{flex:1;padding:10px;background:#1a8c3a;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:.85em;transition:all .2s}.controls button:hover:not(:disabled){background:#0d5f1f;transform:scale(1.02)}.controls button:disabled{background:#555;cursor:not-allowed;opacity:.5}.sidebar{width:100%;display:flex;flex-direction:column;gap:8px;max-height:140px;overflow:hidden}.turn-bar{overflow-y:auto;background:rgba(255,255,255,.03);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);font-size:.8em}.turn-list{display:flex;gap:12px;overflow-x:auto;padding-right:8px}.turn-item{flex-shrink:0;padding:8px 12px;background:rgba(255,255,255,.08);border-left:3px solid #666;border-radius:6px;min-width:120px}.turn-item.current{border-left-color:#ffb74d;background:rgba(255,184,77,.15);font-weight:bold;color:#ffb74d}.turn-item.you{border-left-color:#51cf66;background:rgba(81,207,102,.15);color:#51cf66}.turn-item.finished{opacity:.4;border-left-color:#999}.badges{display:flex;gap:4px;font-size:.7em;margin-top:4px}.cpu-badge{background:#9775fa;color:white;padding:2px 6px;border-radius:3px}.role-badge{background:#ff9800;color:white;padding:2px 6px;border-radius:3px}.finish-badge{background:#51cf66;color:white;padding:2px 6px;border-radius:3px}#log{background:#1a1a1a;color:#00ff00;padding:8px;border-radius:8px;overflow-y:auto;font-family:'Courier New',monospace;font-size:.7em;line-height:1.3;border:1px solid #333;max-height:80px}#swapBanner{background:linear-gradient(135deg,#ff9800,#f57c00);padding:12px;border-radius:12px;text-align:center;border:2px solid #fff;margin-bottom:8px;display:none}.role-display{background:rgba(255,152,0,.2);border:2px solid #ff9800;padding:12px;border-radius:10px;text-align:center;margin-bottom:8px}.role-display h3{font-size:1em;margin-bottom:6px;color:#fff}.role-display .desc{font-size:.85em;color:#ffb74d}#yourTurnBanner{background:linear-gradient(135deg,#51cf66,#2f9e44);padding:10px;border-radius:8px;text-align:center;font-weight:bold;font-size:.95em;margin-bottom:8px;display:none;animation:pulse 1s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}#errorBanner{background:linear-gradient(135deg,#ff6b6b,#e03131);padding:10px;border-radius:8px;text-align:center;font-weight:bold;font-size:.85em;display:none;margin-bottom:8px}#setupSection{padding:12px;background:rgba(255,255,255,.05);border-radius:12px;border:1px solid rgba(255,255,255,.1);margin-bottom:12px}#setupSection input,#setupSection select{padding:8px;border:1px solid #444;border-radius:5px;background:#1a1a1a;color:white;font-size:.85em;width:100%;margin-bottom:8px}#setupSection button{padding:10px;width:100%;margin-bottom:6px;background:#1a8c3a;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:bold;font-size:.85em}#setupSection button:hover{background:#0d5f1f}#setupSection button:disabled{background:#555;opacity:.5}</style></head><body><div class="connection-bar" id="connectionBar"></div><div class="version-badge">v1.6.26</div><div class="audio-controls"><input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50"><div class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</div></div><div class="game-container"><div id="setupSection"><input type="text" id="playerName" placeholder="Your Name"><div style="display:flex;gap:6px;margin:8px 0;"><label style="flex:1;display:flex;align-items:center;gap:4px;color:#aaa;font-size:.8em;"><input type="checkbox" id="addCPU" checked style="width:auto;margin:0;">CPU</label><select id="numPlayers" style="flex:1;"><option value="2">2 Players</option><option value="3">3 Players</option><option value="4" selected>4 Players</option><option value="5">5 Players</option><option value="6">6 Players</option><option value="7">7 Players</option><option value="8">8 Players</option></select></div><div style="display:flex;gap:6px;margin:8px 0;"><label style="color:#aaa;font-size:.8em;">CPU:</label><select id="numCPU" style="flex:1;"><option>0</option><option>1</option><option selected>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option></select></div><button id="createBtn" onclick="createGame()" style="margin-bottom:8px;">üéÆ CREATE</button><input id="roomCode" placeholder="Room Code"><button id="joinBtn" onclick="joinGame()" style="margin-bottom:8px;">üö™ JOIN</button><button id="startBtn" onclick="startGame()">‚ñ∂Ô∏è START</button></div><div id="swapBanner"><h3 style="margin:0 0 4px 0;">üîÑ SELECT CARDS TO SWAP</h3><p id="swapInstructions" style="margin:0;font-size:.85em;"></p></div><div id="yourTurnBanner">üîî YOUR TURN!</div><div id="errorBanner"></div><div id="roleInfo"></div><div class="game-area"><div class="pile-section"><div class="pile-title">‚ô†Ô∏è TABLE</div><div class="current-player" id="currentPlayerDisplay"></div><div class="pile-cards" id="pileCards"><span class="pile-empty">Waiting...</span></div></div><div class="hand-section"><div class="hand-title">üÉè YOUR HAND</div><div class="hand-display" id="handDisplay"><span style="color:#888;">Loading...</span></div><div class="controls"><button id="playBtn" onclick="playSelectedCards()">‚ñ∂ PLAY</button><button onclick="clearSelection()">‚úï CLEAR</button><button id="passBtn" onclick="passTurn()">‚è≠ PASS</button></div></div></div><div class="sidebar"><div class="turn-bar"><div class="turn-list" id="turnList"><span style="color:#888;">Players loading...</span></div></div><div id="log"></div></div></div><script>const SERVER_URL='https://president.fly.dev';let socket,myId,room,hand=[],sel=new Set(),swapReq=null,lastPhase='waiting';let audioContext=null,processing=false,lastStateUpdate=0;let soundEnabled=localStorage.getItem('soundEnabled')!=='false';let soundVolume=parseFloat(localStorage.getItem('soundVolume')||'50')/100;const DEBOUNCE_MS=100;const STATE_TIMEOUT=5000;function initAudio(){if(audioContext)return;try{audioContext=new(window.AudioContext||window.webkitAudioContext)();}catch(e){}}function playSound(freq=800,duration=.2){if(!soundEnabled||!audioContext)return;try{const osc=audioContext.createOscillator(),gain=audioContext.createGain();osc.connect(gain);gain.connect(audioContext.destination);osc.frequency.value=freq;osc.type='sine';gain.gain.setValueAtTime(soundVolume,audioContext.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+duration);osc.start(audioContext.currentTime);osc.stop(audioContext.currentTime+duration);}catch(e){}}function toggleSound(){soundEnabled=!soundEnabled;localStorage.setItem('soundEnabled',soundEnabled);document.getElementById('soundToggle').textContent=soundEnabled?'üîä':'üîá';}function updateVolume(val){soundVolume=val/100;localStorage.setItem('soundVolume',val);}document.getElementById('volumeSlider').addEventListener('input',e=>updateVolume(e.target.value));document.getElementById('volumeSlider').value=soundVolume*100;function log(m){const d=document.getElementById('log');if(!d)return;d.innerHTML+=`${m}<br>`;d.scrollTop=d.scrollHeight;}function getRoleInfo(role){const info={President:{emoji:'üëë',desc:'Give 2 WORST cards'},'Vice President':{emoji:'üíé',desc:'Give 1 WORST card'},Asshole:{emoji:'üí©',desc:'Pick 2 BEST cards'},'Vice Asshole':{emoji:'üí£',desc:'Pick 1 BEST card'},Neutral:{emoji:'üôÇ',desc:'No swap'}};return info[role]||{emoji:'üé¥',desc:''};}function updateConnectionBar(status){const bar=document.getElementById('connectionBar');bar.style.background=status==='connected'?'#51cf66':status==='reconnecting'?'#ff9800':'#d32f2f';}function autoConnect(){initAudio();if(!socket){socket=io(SERVER_URL,{reconnection:true,reconnectionDelay:300,reconnectionDelayMax:1000,reconnectionAttempts:50,timeout:2000,transports:['websocket','polling']});socket.on('connect',()=>{myId=socket.id;updateConnectionBar('connected');['createBtn','joinBtn','startBtn','playBtn','passBtn'].forEach(id=>{const btn=document.getElementById(id);if(btn)btn.disabled=false;});log('‚úÖ Ready');playSound(800,.15);});socket.on('disconnect',()=>{updateConnectionBar('reconnecting');});socket.on('connect_error',()=>{updateConnectionBar('error');});socket.on('game-created',d=>{room=d.roomCode;document.getElementById('roomCode').value=d.roomCode;log('üìç '+d.roomCode);playSound(600,.15);});socket.on('game-started',()=>{log('üéÆ Started');playSound(1000,.2);document.getElementById('setupSection').style.display='none';});socket.on('game-state-update',s=>{const now=Date.now();if(now-lastStateUpdate<DEBOUNCE_MS)return;lastStateUpdate=now;if(processing)return;try{if(s.phase!==lastPhase){clearSelection();lastPhase=s.phase;}renderTurnOrder(s);document.getElementById('currentPlayerDisplay').textContent=s.currentPlayerName+(s.isYourTurn?' (YOU)':'');document.getElementById('yourTurnBanner').style.display=s.isYourTurn?'block':'none';if(s.isYourTurn)playSound(1200,.2);if(s.phase==='swapping'&&s.swapRequired){const info=getRoleInfo(s.roles[myId]);swapReq=s.swapRequired;document.getElementById('swapBanner').style.display='block';document.getElementById('swapInstructions').textContent='Select '+s.swapRequired.count+' card'+(s.swapRequired.count>1?'s':'');document.getElementById('roleInfo').innerHTML='<div class="role-display"><h3>'+info.emoji+' '+s.roles[myId]+'</h3><div class="desc">'+info.desc+'</div></div>';document.getElementById('playBtn').onclick=()=>submitSwap();document.getElementById('playBtn').textContent='üîÑ SWAP';}else{swapReq=null;document.getElementById('swapBanner').style.display='none';document.getElementById('roleInfo').innerHTML='';document.getElementById('playBtn').onclick=()=>playSelectedCards();document.getElementById('playBtn').textContent='‚ñ∂ PLAY';}const m=s.players.find(p=>p.id===myId);if(m&&m.hand){hand=m.hand;render();}const pile=document.getElementById('pileCards');if(!s.lastPlay||!s.lastPlay.cards||s.lastPlay.cards.length===0)pile.innerHTML='<span class="pile-empty">Clear</span>';else{pile.innerHTML='';s.lastPlay.cards.forEach(card=>{const d=document.createElement('div');d.className='pile-card '+((card.suit==='H'||card.suit==='D')?'red':'black');d.textContent=card.rank+({H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[card.suit]);pile.appendChild(d);});}document.getElementById('passBtn').disabled=!s.lastPlay||s.lastPlay.type==='none'||!s.isYourTurn;processing=false;setTimeout(()=>{processing=false;},STATE_TIMEOUT);}catch(e){console.error(e);processing=false;}});socket.on('error',d=>{log('‚ùå '+d.message);playSound(300,.2);});}}function renderTurnOrder(s){const list=document.getElementById('turnList');list.innerHTML='';s.players.forEach(p=>{const d=document.createElement('div');d.className='turn-item'+(p.id===s.currentPlayerId?' current':'')+(p.id===myId?' you':'')+(p.finished?' finished':'');let html=p.name;if(p.role)html+='<span class="role-badge">'+p.role.substring(0,1)+'</span>';if(p.isCPU)html+='<span class="cpu-badge">CPU</span>';if(p.finished)html+='<span class="finish-badge">#'+p.finishPosition+'</span>';d.innerHTML=html;list.appendChild(d);});}function createGame(){const name=document.getElementById('playerName').value||'Player'+Math.floor(Math.random()*1000);const numPlayers=parseInt(document.getElementById('numPlayers').value);const numCPU=parseInt(document.getElementById('numCPU').value);if(numCPU>=numPlayers){alert('CPU count must be less than total players');return;}socket.emit('create-game',{playerName:name,options:{num_players:numPlayers,addCPU:numCPU>0,numCPU:numCPU}});log('Creating game...');}function joinGame(){const c=document.getElementById('roomCode').value.toUpperCase().trim();if(!c||c.length!==6)return;room=c;const name=document.getElementById('playerName').value||'Player'+Math.floor(Math.random()*1000);socket.emit('join-game',{roomCode:c,playerName:name});log('Joining '+c);}function startGame(){socket&&room&&socket.emit('start-game',{roomCode:room});}function render(){const h=document.getElementById('handDisplay');if(!h||!hand)return;h.innerHTML='';hand.forEach((c,i)=>{const d=document.createElement('div');d.className='card '+((c.suit==='H'||c.suit==='D')?'red':'black')+(sel.has(i)?' selected':'');d.textContent=c.rank+({H:'‚ô•',D:'‚ô¶',C:'‚ô£',S:'‚ô†'}[c.suit]);d.onclick=()=>{if(swapReq&&sel.size>=swapReq.count&&!sel.has(i))return;sel.has(i)?sel.delete(i):sel.add(i);playSound(600,.1);render();if(swapReq)document.getElementById('playBtn').disabled=sel.size!==swapReq.count;};h.appendChild(d);});}function clearSelection(){sel.clear();render();}function playSelectedCards(){if(processing||!socket||!room||sel.size===0||Date.now()-lastStateUpdate<DEBOUNCE_MS)return;processing=true;socket.emit('play-cards',{roomCode:room,cardIndices:Array.from(sel).sort((a,b)=>a-b)});sel.clear();}function passTurn(){if(processing||!socket||!room||Date.now()-lastStateUpdate<DEBOUNCE_MS)return;processing=true;socket.emit('pass-turn',{roomCode:room});log('‚è≠ Pass');}function submitSwap(){if(processing||!socket||!room||!swapReq||sel.size!==swapReq.count||Date.now()-lastStateUpdate<DEBOUNCE_MS)return;processing=true;socket.emit('submit-swap',{roomCode:room,cardIndices:Array.from(sel).sort((a,b)=>a-b)});sel.clear();log('‚úÖ Swap');playSound(1000,.2);}window.addEventListener('load',()=>{updateVolume(soundVolume*100);autoConnect();});</script></body></html>